<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <meta name="apple-mobile-web-app-cabaple" content="yes"> 
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    
	<title>History of Helsinki buildings</title>
	
<!-- Mapbox script -->
	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.12.4/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.12.4/mapbox-gl.css' rel='stylesheet' />
	
	<script src='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.js'></script>
	<link href='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.css' rel='stylesheet' />
	
<!-- Bootstarp scriptit -->
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
		
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
	 
<!--own styles
	<link rel="stylesheet" href="styles.css"> --> 
	<link href="nouislider.min.css" rel="stylesheet">
		
 <style>
    
	html, body {
		overflow:hidden;
		height:100%;
		margin:100; 
		padding:0;
	}
	
	#header {
/*	background-image: url("dark.png");*/
		background-color:black;
        color: white;
        text-align: center;
        font-family: "Lucida Sans Unicode", Lucida Grande, sans-serif;
        position: fixed;
        z-index: 50;
        right: 0;
        left: 0;
        top: 0;
    }
		
	#map {
		width:100%;
		height:100%;
		position:absolute;
		left:0;
	}

	
	
    .sidebar {
        position: absolute;
        top: 0;
        right: 0;
        width: 250px;
        bottom: 150;
        overflow-x: auto;
        background-color: #1d879f;
        font-family: "Lucida Sans Unicode", Lucida Grande, sans-serif;
        margin: 0;
        padding: 5px;
        font-size: 14px;
        font-weight: bold;
        border-radius: 10px;
        text-align: center;
        z-index: 80;
    }
		
	#slider {
        height: 20px;
        margin: 0 auto 30px;
        width: 500px;
    }

    #beginYear span {
        color: white;
        }

    #beginSpan {
        font-size: 12px;
        font-weight: bold;
    }

    #endYear span {
        color: white;
    }

    #endSpan {
        font-size: 12px;
        font-weight: bold;
    }
	
<!--show and hide layer buildings unnecessary???-->
	#menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 10px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0,0,0,0.4);
        font-family: 'Open Sans', sans-serif;
    }

    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
    }

    #menu a:last-child {
        border: none;
    }

    #menu a:hover {
        background-color: #f8f8f8;
        color: #404040;
    }

    #menu a.active {
        background-color: #3887be;
        color: #ffffff;
    }

    #menu a.active:hover {
        background: #3074a4;
    }


        @media screen and (max-width:549px) {
            h1 {
                font-size: 24px;
            }

            .ol-toggle-options {
                z-index: 1000;
                position: absolute;
                right: 7px;
                bottom: 3px;
            }
            /* .btn{padding:5px 11px;} */
            div span:last-of-type {
                display: block;
            }
        }


        @media screen and (min-width: 550px) and (max-width:800px) {
            h1 {
                font-size: 30px;
            }

            .ol-toggle-options {
                z-index: 1000;
                position: absolute;
                right: 10px;
                bottom: 10px;
            }
        }
        /* iso naytto */
        @media screen and (min-width: 801px) {
            h1 {
                font-size: 36px;
            }

            .ol-toggle-options {
                z-index: 1000;
                position: absolute;
                right: 10px;
                bottom: 15px;
            }
	
	.rakennustyyppiList
        {
            color:black; 
            font-size:10px !important;
        }
	
.legend-container {
    position: absolute;
    bottom: 30px;
    left: 0;
    padding: 10px;
    margin-bottom: 30px;
    z-index: 1;
	height: 113px;
}

.legend {
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    background-color: #fff;
    padding: 10px;
    border-radius: 3px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.10);
}

.legend h4 {
    margin: 0 0 10px;
}

.legend-key {
    display: inline-block;
    border-radius: 50%;
    width: 10px;
    height: 10px;
    margin-right: 5px;
}

.ui-select {
  background:#fff;
  position:absolute;
  top:10px;
  left:10px;
  z-index:100;
  padding:10px;
  border-radius:3px;
  }
	
</style>
</head>

<body>	

<!-- Function scripts -->
	<script src="nouislider.min.js"></script>
<!-- 	<script src="map.js"></script> -->

<!-- Plugin to geocoder script -->
	<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v0.1.0/mapbox-gl-geocoder.js'></script>
	<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v0.1.0/mapbox-gl-geocoder.css' type='text/css' />

	<div id='map'></div>

<!-- Header -->
	<div class="container-fluid">
		<div id="header">
				<h2><span>History of Helsinki</span></h2>
		   
			<div class="ol-toggle-options">  
				<button class="btn btn-primary" title="Sivupalkki" onClick="toggleControlPanel()" href="#toggle">Menu</button>   
			</div>
		<!--	<div class='map-overlay top'>
				<div class='map-overlay-inner'>
					<!--<h2>Years</h2>
					<label id='month'></label>
					<input id='slider' type='range' min='1700' max='2013' step='1' value='0' />
				</div>
				<div class='map-overlay-inner'>
				</div>
			</div> -->
		</div>	
		
<!-- changing basemap -->	
		<div id='sidebar' class='sidebar' style="display: none;">
			<button class="btn btn-primary" title="Sivupalkki" onClick="toggleControlPanel()" href="#toggle">Hide menu</button>
			<div style="text-align: left; margin-left:1%;">
				<h4> Select basemap: </h4>
				<input id='basic' type='radio' name='rtoggle' value='basic' checked='checked'>
				<label for='basic'>basic</label><br>
				<input id='streets' type='radio' name='rtoggle' value='streets'>
				<label for='streets'>streets</label><br>
				<input id='emerald' type='radio' name='rtoggle' value='emerald'>
				<label for='emerald'>emerald</label><br>
				<input id='bright' type='radio' name='rtoggle' value='bright'>
				<label for='bright'>bright</label><br>
				<input id='light' type='radio' name='rtoggle' value='light'>
				<label for='light'>light</label><br>
				<input id='dark' type='radio' name='rtoggle' value='dark'>
				<label for='dark'>dark</label><br>
				<input id='satellite' type='radio' name='rtoggle' value='satellite'>
				<label for='satellite'>satellite</label>
				<br>
				<h4>Select filter:</h4>
                <div class="btn-group">
				
                    <button data-toggle="dropdown" class="btn btn-primary dropdown">Building types</button>
                    <button data-toggle="dropdown" class="btn btn-primary dropdown-toggle" data-placeholder="false"><span class="caret"></span></button>
                    <ul class="dropdown-menu" style="padding-left:10px;">
                        <li class="rakennustyyppiList"><input type="checkbox" onclick="handleBuildingtypes(this, '\'A Asuinrakennukset\'');" />Asuinrakennukset</li>
                        <li class="rakennustyyppiList"><input type="checkbox"  onclick="handleBuildingtypes(this, '\'B Vapaa-ajan asuinrakennukset\'');" />Vapaa-ajan asuinrakennukset</li>
                        <li class="rakennustyyppiList"><input type="checkbox"  onclick="handleBuildingtypes(this, '\'C Liikerakennukset\'');" />Liikerakennukset</li>
                        <li class="rakennustyyppiList"><input type="checkbox"  onclick="handleBuildingtypes(this, '\'D Toimistorakennukset\'');" />Toimistorakennukset</li>
                        <li class="rakennustyyppiList"><input type="checkbox"  onclick="handleBuildingtypes(this, '\'E Liikenteen rakennukset\'');" />Liikenteen rakennukset</li>
                        <li class="rakennustyyppiList"><input type="checkbox"  onclick="handleBuildingtypes(this, '\'F Hoitoalan rakennukset\'');" />Hoitoalan rakennukset</li>
                        <li class="rakennustyyppiList"><input type="checkbox"  onclick="handleBuildingtypes(this, '\'G Kokoontumisrakennukset\'');" />Kokoontumisrakennukset</li>
                        <li class="rakennustyyppiList"><input type="checkbox" onclick="handleBuildingtypes(this, '\'H Opetusrakennukset\'');" />Opetusrakennukset</li>
                        <li class="rakennustyyppiList"><input type="checkbox"  onclick="handleBuildingtypes(this, '\'J Teollisuusrakennukset\'');" />Teollisuusrakennukset</li>
                        <li class="rakennustyyppiList"><input type="checkbox"  onclick="handleBuildingtypes(this, '\'K Varastorakennukset\'');" />Varastorakennukset</li>
                        <li class="rakennustyyppiList"><input type="checkbox"  onclick="handleBuildingtypes(this, '\'L Palo- ja pelastustoimen rakennukset\'');" />Palo- ja pelastustoimen rakennukset</li>
                        <li class="rakennustyyppiList"><input type="checkbox"  onclick="handleBuildingtypes(this, '\'M Maatalousrakennukset\'');" />Maatalousrakennukset</li>
                        <li class="rakennustyyppiList"><input type="checkbox"  onclick="handleBuildingtypes(this, '\'N Muut rakennukset\'');" />Muut rakennukset</li>
                    </ul>
				
                </div>
                <br>
                <br>
                <h4><link> Helsinki building data: </link> </h4>
                <a href="http://www.hri.fi/fi/data/helsingin-kaupungin-rakennusrekisterin-ote-62012/">Helsingin kaupungin rakennusrekisterin ote 6/2012 </a>
                <br>
                <br>
                <h4> Developer team: </h4>Miska Kauppinen<br/>Gabriela Adamczyk<br/>Juhani Keskitalo<br />
			</div>
			
			<!--to show and hide layer buildings unnecessary???-->
			<nav id="menu"></nav>		
		</div>
		
			<div class='legend-container'>
			  <div id='legend' class='legend'>
				<h4>Year of construction</h4>
			  </div>
			</div>
			
			<div id='filtersss' class='ui-select'>
			  <div><input type='checkbox' checked=checked class='filter'
						 name='filter' id='fast-food' value='fast-food'/><label for='fast-food'>fast-food</label></div>
			  <div><input type='checkbox' checked=checked class='filter'
						 name='filter' id='bicycle' value='bicycle'/><label for='bicycle'>bicycle</label></div>
			  <div><input type='checkbox' checked=checked class='filter'
						 name='filter' id='bar' value='bar'/><label for='bar'>bar</label></div>
			</div>
	
	</div>


	
	
	
	
<!-- possible footer -->
   <!-- <div class="container-fluid">
            <div id="footer">
                <p> Web Map Project</p>
            </div>
        </div> -->


		
<script>

mapboxgl.accessToken = 'pk.eyJ1IjoiZ2FicmllbGFhZGFtY3p5ayIsImEiOiJjaWpldzV6ZncwMDA1dnhtNG56OGdhc2FvIn0.jW6mw1QLlMkBLgpAH0NXqA';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/dark-v8',
    center: [24.980367, 60.192829],
    zoom: 11.2
});

// The key name that exists in each polygon properties
// object we want to display
var facet = 'Year_of_co';

// Show the state choropleth first
var level = 'Address';

// Create a popup, but don't add it to the map yet.
var popup = new mapboxgl.Popup({
    closeButton: false
});

// The values in each array are:
// 1. Color of choropleth
// 2. State population value
// 3. County population value
var layers = [
    ['#a50f15', 2000],
    ['#de2d26', 1980],
    ['#fb6a4a', 1950],
    ['#fc9272', 1918],
    ['#fcbba1', 1870],
    ['#fee5d9', 1700]
   // ['#F2F12D', 0]
];

function filterBy(type) {
    // Which value in each layers array
    // should be used for filtering.
    var position = type === 'Address' ? 1 : 2;

    layers.forEach(function(layer, i) {
        var filters = [
            'all',
            ['>=', facet, layer[position]],
            // Does a state or county property (depending on `type`)
            // Exist in a given feature? Just show those:
            ['!=', type, undefined]
        ];

        if (i !== 0) filters.push(['<', facet, layers[i - 1][position]]);
        map.setFilter('layer-' + i, filters);

        // Set the legend value for each layer
        document.getElementById('legend-value-' + i).textContent = layer[position];
    });
}

function renderChoropleth() {
    var legend = document.getElementById('legend');

    // Here we pull a vector tile source that makes
    // up our choropleth. The source was uploaded as
    // a GeoJSON document and converted to a a vector
    // tile with property data that looks like this:
    //
    // {
    //    "name": "California"
    //    "population": 38802500
    //    "state": 06
    // },
    // {
    //    "county": 06037
    //    "name": "Los Angeles County"
    //    "population": 9974203
    // }
    // ... etc.
    //
    // Polygon data was added using https://github.com/mbostock/us-atlas
    // Census data was added using http://censusreporter.org/
    map.addSource('buildings', {
        "type": "vector",
        "url": "mapbox://gabrielaadamczyk.1wy6tioi"
    });

    layers.forEach(function(layer, i) {
        map.addLayer({
            "id": "layer-" + i,
            "interactive": true,
            "type": "fill",
            "source": "buildings",
            "source-layer": "buildings",
            "paint": {
                "fill-color": layer[0],
                "fill-opacity": 0.75
            }
        }
		//,'place_label_city_small_s'//
		);

        // Build out legends
        var item = document.createElement('div');

        var key = document.createElement('span');
        key.className = 'legend-key';
        key.style.backgroundColor = layer[0];

        var value = document.createElement('span');
        value.id = 'legend-value-' + i;

        item.appendChild(key);
        item.appendChild(value);
        legend.appendChild(item);
    });

    // Initially filter this by the state level
    filterBy(level);
}

map.on('style.load', renderChoropleth);

/*map.on('move', function(e) {
    var z = e.target.getZoom();

    if (z > 4 && level !== 'county') {
        level = 'county';
        filterBy(level);
    }

    if (z <= 4 && level !== 'state') {
        level = 'state';
        filterBy(level);
    }
});*/

map.on('mousemove', function(e) {
    map.featuresAt(e.point, {

        // Collect each layer id we created into an array.
        layer: layers.map(function(layer, i) {
            return 'layer-' + i;
        })
    }, function(err, features) {
        // Change the cursor style as a UI indicator.
        map.getCanvas().style.cursor = (!err && features.length) ? 'pointer' : '';

        if (err || !features.length) {
            popup.remove();
            return;
        }

        var details = features[0].properties;

        // Initialize a popup and set its coordinates
        // based on the feature found.
        popup.setLngLat(e.lngLat)
            .setHTML('<b>Year of construction: </b>' + details[facet] + 
						'<br><b>Address: </b>' + details["Address"] + 
						'<br><b>Type: </b>' + details["Intended_U"] +
						'<br><b>Facade: </b>' + details["Facade"] +
						'<br><b>Number of apartments: </b>' + details["Number_of"] +
						'<br><b>ID: </b>' + details["building_c"])
            .addTo(map);
    });
});

		
<!-- changing basemap -->	
		var layerList = document.getElementById('sidebar');
		var inputs = layerList.getElementsByTagName('input');

		function switchLayer(layer) {
			var layerId = layer.target.id;
			map.setStyle('mapbox://styles/mapbox/' + layerId + '-v8');
		}
		for (var i = 0; i < inputs.length; i++) {
			inputs[i].onclick = switchLayer;
		}
		
<!-- Hiding the side panel -->		
		function toggleControlPanel(){
        var sidebar = document.getElementById("sidebar");
        if (sidebar.style.display == "none") {
          sidebar.style.display = "block";
        }
        else {
          sidebar.style.display = "none";
        }
		}

<!--show and hide layer buildings unnecessary???-->		
		function addLayer(name, id) {
			var link = document.createElement('a');
			link.href = '#';
			link.className = 'active';
			link.textContent = name;

			link.onclick = function (e) {
				e.preventDefault();
				e.stopPropagation();

				var visibility = map.getLayoutProperty(id, 'visibility');

				if (visibility === 'visible') {
					map.setLayoutProperty(id, 'visibility', 'none');
					this.className = '';
				} else {
					this.className = 'active';
					map.setLayoutProperty(id, 'visibility', 'visible');
				}
			};

			var layers = document.getElementById('menu');
			layers.appendChild(link);
		}
 

	function handleBuildingtypes(checkbox, value) {
        deleteMap();
        rakennustyyppi.trim();
        if (checkbox.checked) {
            if (rakennustyyppi != '') {
                rakennustyyppi = rakennustyyppi + ', ' + value;
            }
            else {
                rakennustyyppi = rakennustyyppi + value;
            }
        }
        else {
            rakennustyyppi = rakennustyyppi.replace(', ' + value, value);
            rakennustyyppi = rakennustyyppi.replace(value, '');
        }

        if (rakennustyyppi.startsWith(',') || rakennustyyppi.startsWith(' ')) {
            rakennustyyppi = rakennustyyppi.substr(1);
        }
        var zoomi = googlemap.getZoom();
        var centercoords = googlemap.getCenter();
        updateDataLayer();
        //update(zoomi, centercoords, mapType);
    }
		
		
		
  
// Add zoom and rotation controls to the map
		map.addControl(new mapboxgl.Navigation());		
		

// Add geocoder			
		map.addControl(new mapboxgl.Geocoder());


</script>
</body>
</html>
